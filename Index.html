<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRYPT-X | TERMINAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        
        :root {
            --matrix-green: #00ff41;
            --dark-bg: #0a0a0a;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--dark-bg);
            color: var(--matrix-green);
            background-image: radial-gradient(circle, #111 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .matrix-card {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--matrix-green);
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.15);
            backdrop-filter: blur(5px);
        }

        .glow-text {
            text-shadow: 0 0 8px rgba(0, 255, 65, 0.6);
        }

        input, textarea {
            background: #000 !important;
            border: 1px solid #333 !important;
            color: var(--matrix-green) !important;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus {
            border-color: var(--matrix-green) !important;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
            outline: none;
        }

        .btn-primary {
            background: var(--matrix-green);
            color: black;
            font-weight: bold;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background: #00cc33;
            box-shadow: 0 0 15px var(--matrix-green);
            transform: translateY(-1px);
        }

        .scanline {
            width: 100%;
            height: 2px;
            background: rgba(0, 255, 65, 0.1);
            position: absolute;
            animation: scan 4s linear infinite;
        }

        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6 relative overflow-hidden">
    <div class="scanline"></div>

    <div class="max-w-2xl w-full matrix-card rounded-xl p-8 z-10">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-black glow-text tracking-tighter mb-2">CRYPT-X TERMINAL v2.0</h1>
            <p class="text-xs opacity-50 uppercase tracking-[0.3em]">End-to-End Local Obfuscation</p>
            <div class="mt-4 h-[1px] w-full bg-gradient-to-r from-transparent via-[#00ff41] to-transparent"></div>
        </div>

        <div class="space-y-6">
            <div class="flex flex-col md:flex-row md:items-center gap-4">
                <label class="text-sm font-bold">کلید دسترسی (PIN):</label>
                <input type="number" id="secretKey" value="7" min="0" max="999" 
                       class="w-full md:w-32 px-4 py-2 rounded-md text-center text-lg font-mono">
                <span class="text-[10px] text-gray-500 italic leading-tight">این عدد را فقط فرستنده و گیرنده باید بدانند.</span>
            </div>

            <div>
                <label class="block mb-2 text-sm opacity-80 font-bold">ورودی داده (متن ساده یا کد):</label>
                <textarea id="mainInput" class="w-full h-40 p-4 rounded-lg text-right leading-relaxed" 
                          placeholder="پیام خود را اینجا وارد کنید..."></textarea>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="processData(true)" class="btn-primary py-4 rounded-lg uppercase">
                    قفل کردن (Encrypt)
                </button>
                <button onclick="processData(false)" class="border border-[#00ff41] py-4 rounded-lg hover:bg-[#00ff41]/10 transition-all uppercase">
                    باز کردن (Decrypt)
                </button>
            </div>

            <div class="mt-8">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs opacity-50 uppercase">Output Console:</span>
                    <span id="statusLabel" class="text-[10px] hidden animate-pulse">آماده کپی</span>
                </div>
                <div id="finalResult" onclick="copyToClipboard()" 
                     class="group relative w-full min-h-[100px] p-4 bg-black/50 border border-dashed border-gray-700 rounded-lg cursor-pointer flex items-center justify-center text-center break-all transition-all hover:border-[#00ff41]">
                    <span id="resultText" class="opacity-40 italic">در انتظار پردازش...</span>
                    <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 bg-black/80 transition-opacity rounded-lg">
                        <span class="text-xs font-bold">برای کپی کلیک کنید</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-10 flex justify-between items-center text-[9px] text-gray-600 uppercase font-mono">
            <span>Status: Encrypted_Link_Active</span>
            <span>Secure_Protocol: Base64_Salted</span>
        </div>
    </div>

    <script>
        function processData(isEncrypt) {
            const input = document.getElementById('mainInput').value.trim();
            const key = parseInt(document.getElementById('secretKey').value) || 0;
            const resultDisplay = document.getElementById('resultText');
            const statusLabel = document.getElementById('statusLabel');

            if (!input) {
                alert("لطفاً متنی را وارد کنید!");
                return;
            }

            try {
                if (isEncrypt) {
                    // Encryption Logic
                    let charCodes = [];
                    for (let i = 0; i < input.length; i++) {
                        charCodes.push(input.charCodeAt(i) + key);
                    }
                    
                    // Convert to JSON -> Base64 -> Reverse -> Add Salt
                    let encoded = btoa(unescape(encodeURIComponent(JSON.stringify(charCodes))));
                    let reversed = encoded.split("").reverse().join("");
                    let final = "CX" + reversed + "Z";
                    
                    resultDisplay.innerText = final;
                } else {
                    // Decryption Logic
                    let cleanInput = input;
                    if(cleanInput.startsWith("CX") && cleanInput.endsWith("Z")) {
                        cleanInput = cleanInput.substring(2, cleanInput.length - 1);
                    } else {
                        throw new Error();
                    }

                    let unreversed = cleanInput.split("").reverse().join("");
                    let decodedData = decodeURIComponent(escape(atob(unreversed)));
                    let charCodes = JSON.parse(decodedData);
                    
                    let finalStr = "";
                    for (let code of charCodes) {
                        finalStr += String.fromCharCode(code - key);
                    }
                    resultDisplay.innerText = finalStr;
                }

                // UI Updates
                resultDisplay.parentElement.classList.replace('opacity-40', 'opacity-100');
                resultDisplay.classList.remove('opacity-40', 'italic', 'text-red-500');
                resultDisplay.classList.add('text-white', 'font-bold');
                statusLabel.classList.remove('hidden');

            } catch (err) {
                resultDisplay.innerText = "خطا در رمزگشایی! متن یا کلید اشتباه است.";
                resultDisplay.classList.add('text-red-500');
                resultDisplay.classList.remove('text-white');
                statusLabel.classList.add('hidden');
            }
        }

        async function copyToClipboard() {
            const text = document.getElementById('resultText').innerText;
            if (text && !text.includes("انتظار") && !text.includes("خطا")) {
                await navigator.clipboard.writeText(text);
                const resultBox = document.getElementById('finalResult');
                const originalContent = resultBox.innerHTML;
                
                resultBox.innerHTML = '<span class="text-white font-bold animate-bounce">کپی شد! ✅</span>';
                setTimeout(() => {
                    resultBox.innerHTML = originalContent;
                }, 1500);
            }
        }
    </script>
</body>
</html>
